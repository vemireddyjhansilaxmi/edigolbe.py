<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COVID-19 Analysis Dashboard</title>
    <!-- Bootstrap CSS for base styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
      <!-- Vue.js 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
     <div id="app" class="container-fluid mt-5">
        <h1 class="text-center mb-5 text-danger fw-bold">COVID-19 Recovery Analysis Dashboard</h1>
        
        <!-- Demographics -->
        <div class="row g-4 mb-5">
            <div class="col-lg-6">
                <h3 class="h4 mb-3 text-primary">üìä Demographics</h3>
                <div class="card p-4 bg-light">
                    <div v-if="demographics.gender">
                        <div><strong>Gender:</strong> {{ Object.entries(demographics.gender).map(([k,v]) => `${k}: ${v}`).join(', ') }}</div>
                        <div><strong>Age:</strong> {{ demographics.age?.mean?.toFixed(1) }} yrs ({{ demographics.age?.min }}-{{ demographics.age?.max }})</div>
                    </div>
                    <div v-else>Loading...</div>
                </div>
            </div>
        </div>

        <!-- Prediction Form -->
        <div class="row g-4">
            <div class="col-lg-6">
                <h3 class="h4 mb-3 text-warning">üîÆ Predict Recovery</h3>
                <div class="card p-4">
                    <div class="mb-3">
                        <label>Age:</label>
                        <input v-model.number="age" type="number" class="form-control" min="18" max="100">
                    </div>
                    <div class="mb-3">
                        <label>Contact Number:</label>
                        <input v-model.number="contact" type="number" class="form-control" min="0" max="10">
                    </div>
                    <div class="mb-3">
                        <label>Infection Order:</label>
                        <input v-model.number="order" type="number" class="form-control" min="1" max="50">
                    </div>
                    <button @click="predictRecovery" :disabled="loading" class="btn btn-lg btn-primary w-100">
                        {{ loading ? 'Predicting...' : 'üöÄ Predict Recovery Days' }}
                    </button>
                    
                    <!-- Prediction Result -->
                    <div v-if="prediction" class="mt-3">
                        <div v-if="prediction.error" class="alert alert-danger">
                            ‚ùå {{ prediction.error }}
                        </div>
                        <div v-else class="alert alert-success">
                            ‚úÖ <strong>{{ prediction.prediction?.toFixed(1) }} days</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container mt-5 dashboard-container">
        <h1 class="text-center dashboard-title">COVID-19 Early Case Trend Analysis & Recovery Insights</h1>
        
        <!-- Demographics Section -->
        <div class="row mt-4 section">
            <div class="col-md-6">
                <h3 class="section-title">Demographics</h3>
                <div id="demographics" class="data-display"></div>
                <div id="demographics-plot" class="mt-3 plot-container"></div>
            </div>
            <div class="col-md-6">
                <h3 class="section-title">Recovery Trends</h3>
                <img id="recovery-plot" src="" alt="Recovery Plot" class="img-fluid plot-image">
                <div id="recovery-stats" class="mt-3 data-display"></div>
            </div>
        </div>
        </div>
      

        <!-- Regression Section -->
        <div class="row mt-4 section">
            <div class="col-md-6">
                <h3 class="section-title">Regression Model Stats</h3>
                <div id="regression-stats" class="data-display"></div>
            </div>
            <div class="col-md-6">
                <h3 class="section-title">Predict Recovery Time</h3>
                <form id="predict-form" class="prediction-form" onsubmit="event.preventDefault();">
                    <div class="mb-3">
                        <label for="age" class="form-label">Age</label>
                        <input type="number" class="form-control" id="age" required>
                    </div>
                    <div class="mb-3">
                        <label for="contact" class="form-label">Contact Number</label>
                        <input type="number" class="form-control" id="contact" required>
                    </div>
                    <div class="mb-3">
                        <label for="order" class="form-label">Infection Order</label>
                        <input type="number" class="form-control" id="order" required>
                    </div>
                    <button type="button" class="btn btn-primary submit-btn" onclick="submitPrediction(event)">Predict</button>
                </form>
                <div id="prediction-result" class="mt-3 result-display"></div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and Custom JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="script.js"></script>

    <script>
    // Vue app to power the top prediction card and demographics
    const { createApp } = Vue;
    createApp({
      data() {
        return {
          age: 30,
          contact: 0,
          order: 1,
          loading: false,
          prediction: null,
          demographics: {}
        };
      },
      methods: {
        async predictRecovery() {
          this.loading = true;
          this.prediction = null;
          try {
            const res = await fetch('/api/predict', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                age: this.age,
                contact_number: this.contact,
                infection_order: this.order
              })
            });
            const data = await res.json();
            if (!res.ok) this.prediction = { error: data.error || JSON.stringify(data) };
            else this.prediction = data;
          } catch (e) {
            this.prediction = { error: e.message };
          } finally {
            this.loading = false;
          }
        },
        async loadDemographics() {
          try {
            const r = await fetch('/api/demographics');
            if (r.ok) this.demographics = await r.json();
          } catch {}
        }
      },
      mounted() {
        this.loadDemographics();
      }
    }).mount('#app');
    </script>
</body>
</html>